# shellcheck shell=dash

test_solo_main()(
    if [ "$___X_CMD_PKG_CANDADITE" = "python" ] && [ "$(x os name)" = "win" ];then
        x pkg download python
        local path
        local cmd
        path="$(cygpath -w "${___X_CMD_ROOT_DATA}")"
        cmd="Start-Process -Wait -FilePath \"$path\pkg\download\python\"""$(printf "%s" "${___X_CMD_PKG_CANDADITE_VERSION}")""_win_x64.exe\"  -ArgumentList \"/S /D=$path\pkg\populate\python\"""$(printf "%s" "${___X_CMD_PKG_CANDADITE_VERSION}")"
        /c/WINDOWS/System32/WindowsPowerShell/v1.0/PowerShell.exe "$cmd"
    fi

    x cd .tmp/x-cmd-pkg && \
    xws install "$1" && \
    x pkg _smoke "$___X_CMD_PKG_CANDADITE" "${___X_CMD_PKG_CANDADITE_VERSION}" || return
)

x cd "$(x wsroot)"
xws prepare || return 1
test_solo_main "${___X_CMD_PKG_VERSION:-v0.0.2}" || return
